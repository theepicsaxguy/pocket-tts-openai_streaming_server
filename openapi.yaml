paths:
  /openapi.json:
    get:
      summary: Serve OpenAPI spec for Orval client generation.
      description: Serve OpenAPI spec for Orval client generation.
      responses:
        '200':
          description: Success
  /:
    get:
      summary: Serve the web interface.
      description: Serve the web interface.
      responses:
        '200':
          description: Success
  /health:
    get:
      summary: Health check endpoint for container orchestration.
      description: 'Health check endpoint for container orchestration.


        Returns service status and basic model info.'
      responses:
        '200':
          description: Success
  /v1/voices:
    get:
      summary: List available voices.
      description: 'List available voices.


        Returns OpenAI-compatible voice list format.'
      responses:
        '200':
          description: Success
  /v1/audio/speech:
    post:
      summary: OpenAI-compatible speech generation endpoint.
      description: "OpenAI-compatible speech generation endpoint.\n\nRequest body:\n\
        \    model: string (ignored, for compatibility)\n    input: string (required)\
        \ - Text to synthesize\n    voice: string (optional) - Voice ID or path\n\
        \    response_format: string (optional) - Audio format\n    stream: boolean\
        \ (optional) - Enable streaming\n\nReturns:\n    Audio file or streaming audio\
        \ response"
      responses:
        '200':
          description: Success
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SpeechGenerationBody'
  /api/studio/sources:
    post:
      summary: Upload file, submit URL, paste text, or import git
      description: Upload file, submit URL, paste text, or import git repository.
      responses:
        '200':
          description: Success
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateSourceJsonBody'
          multipart/form-data:
            schema:
              $ref: '#/components/schemas/CreateSourceFileBody'
    get:
      summary: List all sources.
      description: List all sources.
      responses:
        '200':
          description: Success
  /api/studio/sources/{source_id}:
    get:
      summary: Get a source with cleaned text.
      description: Get a source with cleaned text.
      responses:
        '200':
          description: Success
      parameters:
      - name: source_id
        in: path
        required: true
        schema:
          type: string
    put:
      summary: Update source title or cleaned_text.
      description: Update source title or cleaned_text.
      responses:
        '200':
          description: Success
      parameters:
      - name: source_id
        in: path
        required: true
        schema:
          type: string
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateSourceBody'
    delete:
      summary: Delete source and associated episodes/audio.
      description: Delete source and associated episodes/audio.
      responses:
        '200':
          description: Success
      parameters:
      - name: source_id
        in: path
        required: true
        schema:
          type: string
  /api/studio/sources/{source_id}/cover:
    get:
      summary: Get cover art for a source.
      description: Get cover art for a source.
      responses:
        '200':
          description: Success
      parameters:
      - name: source_id
        in: path
        required: true
        schema:
          type: string
    post:
      summary: Upload cover art for a source.
      description: Upload cover art for a source.
      responses:
        '200':
          description: Success
      parameters:
      - name: source_id
        in: path
        required: true
        schema:
          type: string
      requestBody:
        content:
          multipart/form-data:
            schema:
              $ref: '#/components/schemas/SourceCoverUploadBody'
  /api/studio/sources/{source_id}/re-clean:
    post:
      summary: Re-run normalizer on a source with different optio
      description: Re-run normalizer on a source with different options.
      responses:
        '200':
          description: Success
      parameters:
      - name: source_id
        in: path
        required: true
        schema:
          type: string
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ReCleanSourceBody'
  /api/studio/sources/{source_id}/move:
    put:
      summary: Move a source to a folder.
      description: Move a source to a folder.
      responses:
        '200':
          description: Success
      parameters:
      - name: source_id
        in: path
        required: true
        schema:
          type: string
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MoveToFolderBody'
  /api/studio/episodes:
    post:
      summary: "Create an episode \u2014 chunk text and enqueue generat"
      description: "Create an episode \u2014 chunk text and enqueue generation."
      responses:
        '200':
          description: Success
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateEpisodeBody'
    get:
      summary: List all episodes.
      description: List all episodes.
      responses:
        '200':
          description: Success
  /api/studio/episodes/{episode_id}:
    get:
      summary: Get episode with its chunks.
      description: Get episode with its chunks.
      responses:
        '200':
          description: Success
      parameters:
      - name: episode_id
        in: path
        required: true
        schema:
          type: string
    put:
      summary: Update episode metadata.
      description: Update episode metadata.
      responses:
        '200':
          description: Success
      parameters:
      - name: episode_id
        in: path
        required: true
        schema:
          type: string
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateEpisodeBody'
    delete:
      summary: Delete episode and audio files.
      description: Delete episode and audio files.
      responses:
        '200':
          description: Success
      parameters:
      - name: episode_id
        in: path
        required: true
        schema:
          type: string
  /api/studio/episodes/{episode_id}/regenerate:
    post:
      summary: Re-generate all chunks for an episode.
      description: Re-generate all chunks for an episode.
      responses:
        '200':
          description: Success
      parameters:
      - name: episode_id
        in: path
        required: true
        schema:
          type: string
  /api/studio/episodes/{episode_id}/regenerate-with-settings:
    post:
      summary: Re-generate episode with new settings, with undo s
      description: Re-generate episode with new settings, with undo support.
      responses:
        '200':
          description: Success
      parameters:
      - name: episode_id
        in: path
        required: true
        schema:
          type: string
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegenerateWithSettingsBody'
  /api/studio/undo/{undo_id}:
    post:
      summary: Undo an episode regeneration within the grace peri
      description: Undo an episode regeneration within the grace period.
      responses:
        '200':
          description: Success
      parameters:
      - name: undo_id
        in: path
        required: true
        schema:
          type: string
  /api/studio/episodes/bulk-move:
    post:
      summary: Move multiple episodes to a folder.
      description: Move multiple episodes to a folder.
      responses:
        '200':
          description: Success
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BulkMoveEpisodesBody'
  /api/studio/episodes/bulk-delete:
    post:
      summary: Delete multiple episodes.
      description: Delete multiple episodes.
      responses:
        '200':
          description: Success
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BulkDeleteEpisodesBody'
  /api/studio/episodes/{episode_id}/chunks/{chunk_index}/regenerate:
    post:
      summary: Regenerate a single chunk.
      description: Regenerate a single chunk.
      responses:
        '200':
          description: Success
      parameters:
      - name: episode_id
        in: path
        required: true
        schema:
          type: string
      - name: chunk_index
        in: path
        required: true
        schema:
          type: integer
  /api/studio/episodes/{episode_id}/cancel:
    post:
      summary: Cancel a generating episode and reset error chunks
      description: Cancel a generating episode and reset error chunks to pending.
      responses:
        '200':
          description: Success
      parameters:
      - name: episode_id
        in: path
        required: true
        schema:
          type: string
  /api/studio/episodes/{episode_id}/retry-errors:
    post:
      summary: Retry all error chunks for an episode.
      description: Retry all error chunks for an episode.
      responses:
        '200':
          description: Success
      parameters:
      - name: episode_id
        in: path
        required: true
        schema:
          type: string
  /api/studio/episodes/{episode_id}/audio/{chunk_index}:
    get:
      summary: Serve a chunk's audio file.
      description: Serve a chunk's audio file.
      responses:
        '200':
          description: Success
      parameters:
      - name: episode_id
        in: path
        required: true
        schema:
          type: string
      - name: chunk_index
        in: path
        required: true
        schema:
          type: integer
  /api/studio/episodes/{episode_id}/audio/full:
    get:
      summary: Serve merged full episode audio.
      description: Serve merged full episode audio.
      responses:
        '200':
          description: Success
      parameters:
      - name: episode_id
        in: path
        required: true
        schema:
          type: string
  /api/studio/episodes/{episode_id}/move:
    put:
      summary: Move an episode to a folder.
      description: Move an episode to a folder.
      responses:
        '200':
          description: Success
      parameters:
      - name: episode_id
        in: path
        required: true
        schema:
          type: string
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MoveToFolderBody'
  /api/studio/folders:
    post:
      summary: Create a new folder.
      description: Create a new folder.
      responses:
        '200':
          description: Success
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateFolderBody'
  /api/studio/folders/{folder_id}:
    put:
      summary: Rename or move a folder.
      description: Rename or move a folder.
      responses:
        '200':
          description: Success
      parameters:
      - name: folder_id
        in: path
        required: true
        schema:
          type: string
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateFolderBody'
    delete:
      summary: Delete a folder and all its contents (episodes aud
      description: Delete a folder and all its contents (episodes audio files are
        deleted).
      responses:
        '200':
          description: Success
      parameters:
      - name: folder_id
        in: path
        required: true
        schema:
          type: string
  /api/studio/folders/{folder_id}/playlist:
    post:
      summary: Start playing all episodes in a folder as a playli
      description: Start playing all episodes in a folder as a playlist.
      responses:
        '200':
          description: Success
      parameters:
      - name: folder_id
        in: path
        required: true
        schema:
          type: string
  /api/studio/folders/{folder_id}/episodes:
    get:
      summary: Get all episodes in a folder for playlist building
      description: Get all episodes in a folder for playlist building.
      responses:
        '200':
          description: Success
      parameters:
      - name: folder_id
        in: path
        required: true
        schema:
          type: string
  /api/studio/reorder:
    post:
      summary: Batch update sort orders.
      description: Batch update sort orders.
      responses:
        '200':
          description: Success
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ReorderBody'
  /api/studio/tags:
    get:
      summary: List all tags.
      description: List all tags.
      responses:
        '200':
          description: Success
    post:
      summary: Create a tag.
      description: Create a tag.
      responses:
        '200':
          description: Success
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateTagBody'
  /api/studio/tags/{tag_id}:
    delete:
      summary: Delete a tag.
      description: Delete a tag.
      responses:
        '200':
          description: Success
      parameters:
      - name: tag_id
        in: path
        required: true
        schema:
          type: string
  /api/studio/sources/{source_id}/tags:
    post:
      summary: Set tags for a source (replaces all existing).
      description: Set tags for a source (replaces all existing).
      responses:
        '200':
          description: Success
      parameters:
      - name: source_id
        in: path
        required: true
        schema:
          type: string
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SetTagsBody'
  /api/studio/episodes/{episode_id}/tags:
    post:
      summary: Set tags for an episode (replaces all existing).
      description: Set tags for an episode (replaces all existing).
      responses:
        '200':
          description: Success
      parameters:
      - name: episode_id
        in: path
        required: true
        schema:
          type: string
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SetTagsBody'
  /api/studio/playback/{episode_id}:
    get:
      summary: Get playback state for an episode.
      description: Get playback state for an episode.
      responses:
        '200':
          description: Success
      parameters:
      - name: episode_id
        in: path
        required: true
        schema:
          type: string
    post:
      summary: Save playback position.
      description: Save playback position.
      responses:
        '200':
          description: Success
      parameters:
      - name: episode_id
        in: path
        required: true
        schema:
          type: string
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SavePlaybackBody'
  /api/studio/settings:
    get:
      summary: Get all settings.
      description: Get all settings.
      responses:
        '200':
          description: Success
    put:
      summary: Update settings (key-value pairs).
      description: Update settings (key-value pairs).
      responses:
        '200':
          description: Success
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateSettingsBody'
  /api/studio/generation/status:
    get:
      summary: Get generation queue status.
      description: Get generation queue status.
      responses:
        '200':
          description: Success
  /api/studio/library/tree:
    get:
      summary: Get the full library tree structure.
      description: Get the full library tree structure.
      responses:
        '200':
          description: Success
  /api/studio/preview-clean:
    post:
      summary: Preview normalization without saving.
      description: Preview normalization without saving.
      responses:
        '200':
          description: Success
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PreviewCleanBody'
  /api/studio/preview-content:
    post:
      summary: Preview content without importing - for URL and gi
      description: Preview content without importing - for URL and git repos.
      responses:
        '200':
          description: Success
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PreviewContentBody'
  /api/studio/preview-chunks:
    post:
      summary: Preview chunking without creating an episode.
      description: Preview chunking without creating an episode.
      responses:
        '200':
          description: Success
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PreviewChunksBody'
info:
  title: OpenVox API
  version: 1.0.0
openapi: 3.0.3
components:
  schemas:
    SpeechGenerationBody:
      type: object
      properties:
        input:
          type: string
          description: Text to synthesize
        voice:
          type: string
          description: Voice ID or path
        model:
          type: string
          description: Model name (ignored, for OpenAI compatibility)
        response_format:
          type: string
          description: 'Audio format: mp3, wav, pcm, opus'
        stream:
          type: boolean
          description: Enable streaming response
      required:
      - input
      additionalProperties: false
    CleaningSettings:
      type: object
      properties:
        code_block_rule:
          type: string
          description: 'How to handle code blocks: skip, read, summarize'
        remove_non_text:
          type: boolean
        handle_tables:
          type: boolean
        speak_urls:
          type: boolean
        expand_abbreviations:
          type: boolean
        preserve_parentheses:
          type: boolean
        preserve_structure:
          type: boolean
        paragraph_spacing:
          type: integer
        section_spacing:
          type: integer
        list_item_spacing:
          type: integer
      additionalProperties: false
    UrlSettings:
      type: object
      properties:
        use_jina:
          type: boolean
          description: Use Jina Reader for URL extraction
        jina_fallback:
          type: boolean
          description: Fall back to Jina if other methods fail
      additionalProperties: false
    CreateSourceJsonBody:
      type: object
      properties:
        text:
          type: string
          description: Raw text to import
        title:
          type: string
          description: Source title
        url:
          type: string
          description: URL to import content from
        git_url:
          type: string
          description: Git repository URL to import
        git_subpath:
          type: string
          description: Subdirectory path within the git repo
        cleaning_settings:
          description: Override cleaning options
          allOf:
          - $ref: '#/components/schemas/CleaningSettings'
        url_settings:
          description: URL extraction settings
          allOf:
          - $ref: '#/components/schemas/UrlSettings'
      additionalProperties: false
    CreateSourceFileBody:
      type: object
      properties:
        file:
          type: string
          format: binary
          description: File to upload (.md, .txt)
      additionalProperties: false
    SourceCoverUploadBody:
      type: object
      properties:
        cover:
          type: string
          format: binary
          description: Cover art image file
      additionalProperties: false
    UpdateSourceBody:
      type: object
      properties:
        title:
          type: string
        cleaned_text:
          type: string
      additionalProperties: false
    ReCleanSourceBody:
      type: object
      properties:
        code_block_rule:
          type: string
        remove_non_text:
          type: boolean
        handle_tables:
          type: boolean
        speak_urls:
          type: boolean
        expand_abbreviations:
          type: boolean
        preserve_parentheses:
          type: boolean
      additionalProperties: false
    MoveToFolderBody:
      type: object
      properties:
        folder_id:
          type: string
          description: Target folder ID, or null for root
          nullable: true
      additionalProperties: false
    CreateEpisodeBody:
      type: object
      properties:
        source_id:
          type: string
        voice_id:
          type: string
        output_format:
          type: string
        chunk_strategy:
          type: string
          description: paragraph, sentence, heading, or fixed
        chunk_max_length:
          type: integer
        code_block_rule:
          type: string
        breathing_intensity:
          type: string
          description: none, light, normal, heavy
        title:
          type: string
      required:
      - source_id
      additionalProperties: false
    UpdateEpisodeBody:
      type: object
      properties:
        title:
          type: string
      additionalProperties: false
    RegenerateWithSettingsBody:
      type: object
      properties:
        voice_id:
          type: string
        output_format:
          type: string
        chunk_strategy:
          type: string
        chunk_max_length:
          type: integer
        code_block_rule:
          type: string
        breathing_intensity:
          type: string
      additionalProperties: false
    BulkMoveEpisodesBody:
      type: object
      properties:
        episode_ids:
          type: array
          items:
            type: string
        folder_id:
          type: string
          nullable: true
      required:
      - episode_ids
      additionalProperties: false
    BulkDeleteEpisodesBody:
      type: object
      properties:
        episode_ids:
          type: array
          items:
            type: string
      required:
      - episode_ids
      additionalProperties: false
    CreateFolderBody:
      type: object
      properties:
        name:
          type: string
          default: New Folder
        parent_id:
          type: string
          nullable: true
        sort_order:
          type: integer
          default: 0
      additionalProperties: false
    UpdateFolderBody:
      type: object
      properties:
        name:
          type: string
        parent_id:
          type: string
          nullable: true
        sort_order:
          type: integer
      additionalProperties: false
    ReorderItem:
      type: object
      properties:
        type:
          type: string
        id:
          type: string
        sort_order:
          type: integer
      required:
      - id
      - sort_order
      additionalProperties: false
    ReorderBody:
      type: object
      properties:
        items:
          type: array
          default: []
          items:
            $ref: '#/components/schemas/ReorderItem'
      additionalProperties: false
    CreateTagBody:
      type: object
      properties:
        name:
          type: string
      required:
      - name
      additionalProperties: false
    SetTagsBody:
      type: object
      properties:
        tag_ids:
          type: array
          default: []
          description: Tag IDs to assign (replaces existing)
          items:
            type: string
      additionalProperties: false
    SavePlaybackBody:
      type: object
      properties:
        current_chunk_index:
          type: integer
          default: 0
        position_secs:
          type: number
          default: 0.0
        percent_listened:
          type: number
          default: 0.0
      additionalProperties: false
    UpdateSettingsBody:
      type: object
      properties: {}
      additionalProperties: false
    PreviewCleanBody:
      type: object
      properties:
        text:
          type: string
        code_block_rule:
          type: string
      required:
      - text
      additionalProperties: false
    PreviewContentBody:
      type: object
      properties:
        type:
          type: string
          description: 'Content type: url or git'
        url:
          type: string
        subpath:
          type: string
      required:
      - type
      additionalProperties: false
    PreviewChunksBody:
      type: object
      properties:
        text:
          type: string
        strategy:
          type: string
        max_chars:
          type: integer
      required:
      - text
      additionalProperties: false

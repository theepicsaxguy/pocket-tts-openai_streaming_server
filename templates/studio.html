<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, maximum-scale=1.0, user-scalable=no" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="theme-color" content="#0a0a0b" />
    <title>OpenVox</title>
    <link rel="stylesheet" href="/static/css/studio.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,500;0,600;1,400&family=JetBrains+Mono:wght@400;500&family=Outfit:wght@300;400;500;600&display=swap" rel="stylesheet">
</head>
<body>
    <script>
        window.POCKET_TTS_CONFIG = {
            isDocker: {{ 'true' if is_docker else 'false' }}
        };
    </script>

    <!-- Ambient background layer -->
    <div class="ambient-bg">
        <div class="ambient-orb orb-1"></div>
        <div class="ambient-orb orb-2"></div>
        <div class="ambient-orb orb-3"></div>
        <div class="noise-overlay"></div>
    </div>

    <!-- Toast container -->
    <div id="toast-container"></div>

    <!-- App shell -->
    <div class="app-shell">
        <!-- Title bar (macOS style) -->
        <header class="title-bar">
            <div class="title-bar-left">
                <button class="action-btn hamburger-btn" id="btn-hamburger" title="Toggle sidebar" aria-label="Toggle sidebar">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="3" y1="12" x2="21" y2="12"/>
                        <line x1="3" y1="6" x2="21" y2="6"/>
                        <line x1="3" y1="18" x2="21" y2="18"/>
                    </svg>
                </button>
                <div class="window-controls" role="group" aria-label="Window controls">
                    <div class="window-btn close" role="button" aria-label="Close"></div>
                    <div class="window-btn minimize" role="button" aria-label="Minimize"></div>
                    <div class="window-btn maximize" role="button" aria-label="Maximize"></div>
                </div>
            </div>
            <div class="title-bar-center">
                <span class="app-title">OpenVox</span>
            </div>
            <div class="title-bar-actions">
                <button class="action-btn" id="btn-keyboard-help" title="Keyboard shortcuts (?)">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                        <circle cx="12" cy="12" r="10"/>
                        <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/>
                        <line x1="12" y1="17" x2="12.01" y2="17"/>
                    </svg>
                </button>
            </div>
        </header>

        <!-- Main content area -->
        <div class="main-content">
            <!-- Sidebar: Library -->
            <aside class="sidebar" id="sidebar">
                <div class="sidebar-header">
                    <div class="logo-mark">
                        <svg width="28" height="28" viewBox="0 0 24 24" fill="none">
                            <circle cx="12" cy="12" r="3" fill="currentColor"/>
                            <circle cx="12" cy="12" r="6" stroke="currentColor" stroke-width="1.5" opacity="0.5"/>
                            <circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="1" opacity="0.25"/>
                        </svg>
                    </div>
                    <button class="fab-btn" id="btn-new-content" title="Import new content">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="12" y1="5" x2="12" y2="19"/>
                            <line x1="5" y1="12" x2="19" y2="12"/>
                        </svg>
                    </button>
                </div>

                <nav class="sidebar-nav">
                    <div class="nav-section">
                        <h3 class="nav-title">Playback</h3>
                        <button class="nav-item" id="btn-now-playing">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                <circle cx="12" cy="12" r="10"/>
                                <polygon points="10 8 16 12 10 16 10 8" fill="currentColor" stroke="none"/>
                            </svg>
                            <span>Now Playing</span>
                        </button>
                    </div>

                    <div class="nav-section">
                        <h3 class="nav-title">Library</h3>
                        <button class="nav-item" id="btn-new-folder">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                <path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z"/>
                            </svg>
                            <span>New Folder</span>
                        </button>
                    </div>

                    <div class="library-tree-container">
                        <div id="recently-played" class="recent-section" style="display:none">
                            <h4 class="section-label">Recently Played</h4>
                            <div id="recently-played-list"></div>
                        </div>

                        <div class="tree-wrapper">
                            <div class="library-tree" id="library-tree"></div>
                        </div>
                    </div>
                </nav>

                <div class="sidebar-footer">
                    <div class="generation-status-compact" id="generation-status">
                        <div class="status-indicator idle"></div>
                        <span class="status-text">Ready</span>
                    </div>
                    <div class="version-tag">v{{ version }}</div>
                </div>
            </aside>

            <!-- Center stage: Content -->
            <main class="stage" id="stage">
                <!-- View: Import -->
                <div id="view-import" class="stage-view active">
                    <div class="view-hero">
                        <h1 class="hero-title">Add something to listen to</h1>
                        <p class="hero-subtitle">Paste text, upload a file, or grab a URL</p>
                    </div>

                    <div class="import-workspace">
                        <div class="input-methods">
                            <button class="method-btn active" data-tab="paste">
                                <div class="method-icon">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                        <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/>
                                        <rect x="8" y="2" width="8" height="4" rx="1" ry="1"/>
                                    </svg>
                                </div>
                                <span>Paste Text</span>
                            </button>
                            <button class="method-btn" data-tab="file">
                                <div class="method-icon">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                        <polyline points="14 2 14 8 20 8"/>
                                        <line x1="16" y1="13" x2="8" y2="13"/>
                                        <line x1="16" y1="17" x2="8" y2="17"/>
                                        <polyline points="10 9 9 9 8 9"/>
                                    </svg>
                                </div>
                                <span>Upload File</span>
                            </button>
                            <button class="method-btn" data-tab="url">
                                <div class="method-icon">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                        <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/>
                                        <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/>
                                    </svg>
                                </div>
                                <span>From URL</span>
                            </button>
                            <button class="method-btn" data-tab="git">
                                <div class="method-icon">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                        <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"/>
                                    </svg>
                                </div>
                                <span>Git Repository</span>
                            </button>
                        </div>

                        <div class="import-form-container">
                            <div class="form-card">
                                <div class="tab-content active" id="tab-paste">
                                    <div class="input-group">
                                        <label for="import-title">Title <span class="optional">(optional)</span></label>
                                        <input type="text" id="import-title" placeholder="Auto-detected from content" class="text-input"/>
                                    </div>
                                    <div class="input-group">
                                        <label for="import-text">Content</label>
                                        <textarea id="import-text" placeholder="Paste your markdown, documentation, or plain text here..." class="text-area"></textarea>
                                    </div>
                                </div>

                                <div class="tab-content" id="tab-file">
                                    <div class="file-dropzone" id="file-dropzone">
                                        <div class="dropzone-content" id="dropzone-content-default">
                                            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                                <polyline points="17 8 12 3 7 8"/>
                                                <line x1="12" y1="3" x2="12" y2="15"/>
                                            </svg>
                                            <p class="dropzone-text">Drop files here or click to browse</p>
                                            <p class="dropzone-hint">Supports .md, .txt files</p>
                                            <input type="file" id="import-file" accept=".md,.txt" hidden/>
                                        </div>
                                        <div class="dropzone-content dropzone-content-selected hidden" id="dropzone-content-selected">
                                            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                                <polyline points="14 2 14 8 20 8"/>
                                                <line x1="16" y1="13" x2="8" y2="13"/>
                                                <line x1="16" y1="17" x2="8" y2="17"/>
                                                <polyline points="10 9 9 9 8 9"/>
                                            </svg>
                                            <p class="dropzone-filename" id="selected-filename">document.md</p>
                                            <p class="dropzone-hint">File selected - click to change</p>
                                        </div>
                                    </div>
                                </div>

                                <div class="tab-content" id="tab-url">
                                    <div class="input-group">
                                        <label for="import-url">URL</label>
                                        <input type="text" id="import-url" placeholder="https://docs.example.com/article" class="text-input"/>
                                    </div>
                                    <div class="url-preview" id="url-preview"></div>
                                </div>

                                <div class="tab-content" id="tab-git">
                                    <div class="input-group">
                                        <label for="import-git-url">Repository URL</label>
                                        <input type="text" id="import-git-url" placeholder="https://github.com/user/repo or https://github.com/user/repo/tree/main/docs" class="text-input"/>
                                        <p class="input-hint">Supports GitHub, GitLab, and Bitbucket. Will extract only .md, .txt, .markdown files.</p>
                                    </div>
                                    <div class="input-group">
                                        <label for="import-git-subpath">Subdirectory <span class="optional">(optional)</span></label>
                                        <input type="text" id="import-git-subpath" placeholder="e.g., docs/concepts" class="text-input"/>
                                        <p class="input-hint">Extract a specific subdirectory instead of the entire repository.</p>
                                    </div>
                                </div>
                            </div>

                            <div class="form-actions-bar">
                                <button class="btn btn-ghost" id="btn-preview-clean">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                                        <circle cx="12" cy="12" r="3"/>
                                    </svg>
                                    Preview
                                </button>
                                <button class="btn btn-primary" id="btn-import">
                                    <span>Add to Library</span>
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <line x1="5" y1="12" x2="19" y2="12"/>
                                        <polyline points="12 5 19 12 12 19"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Preview panel -->
                    <div id="clean-preview" class="preview-panel hidden">
                        <div class="preview-header">
                            <div>
                                <h3>Text Preview</h3>
                                <p class="preview-title hidden" id="preview-title"></p>
                            </div>
                            <button class="btn-icon" id="btn-close-preview">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="18" y1="6" x2="6" y2="18"/>
                                    <line x1="6" y1="6" x2="18" y2="18"/>
                                </svg>
                            </button>
                        </div>
                        <div class="preview-comparison">
                            <div class="preview-col">
                                <div class="col-header">
                                    <span class="col-label">Original</span>
                                    <span class="col-stats" id="raw-stats"></span>
                                </div>
                                <div class="col-content">
                                    <pre id="preview-raw"></pre>
                                </div>
                            </div>
                            <div class="preview-col">
                                <div class="col-header">
                                    <span class="col-label highlight">Cleaned</span>
                                    <span class="col-stats" id="cleaned-stats"></span>
                                </div>
                                <div class="col-content">
                                    <pre id="preview-cleaned"></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- View: Review -->
                <div id="view-review" class="stage-view">
                    <div class="view-header-compact">
                        <div class="breadcrumbs">
                            <span class="crumb">Library</span>
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="9 18 15 12 9 6"/>
                            </svg>
                            <span class="crumb active" id="review-breadcrumb">Review</span>
                        </div>
                        <div class="header-actions-mobile">
                            <button class="btn btn-primary btn-generate-mobile" id="btn-review-generate-header">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polygon points="5 3 19 12 5 21 5 3"/>
                                </svg>
                                Generate
                            </button>
                        </div>
                    </div>

                    <div class="review-layout">
                        <div class="review-content">
                            <div class="content-card">
                                <div class="card-header">
                                    <h2 id="review-title">Document Title</h2>
                                    <div class="header-actions">
                                        <button class="btn btn-secondary btn-small" id="btn-edit-text" style="display: none;">
                                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/>
                                                <path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"/>
                                            </svg>
                                            Edit Text
                                        </button>
                                    </div>
                                </div>
                                <div class="meta-pills" id="review-meta">
                                    <span class="pill">Text</span>
                                    <span class="pill">0 chars</span>
                                </div>
                                <div class="text-preview" id="review-cleaned-text"></div>
                                <textarea id="review-cleaned-textarea" class="text-editor hidden" rows="10"></textarea>
                                <div id="review-edit-actions" class="edit-actions hidden">
                                    <button class="btn btn-primary btn-small" id="btn-save-text">Save</button>
                                    <button class="btn btn-ghost btn-small" id="btn-cancel-edit">Cancel</button>
                                </div>
                            </div>
                        </div>

                        <div class="review-sidebar">
                            <div class="config-card">
                                <h3>Cover Art</h3>
                                
                                <div class="cover-upload-section">
                                    <div class="cover-preview" id="review-cover-preview">
                                        <img id="review-cover-image" src="" alt="Cover" class="hidden"/>
                                        <div class="cover-placeholder" id="review-cover-placeholder">
                                            <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                                                <circle cx="8.5" cy="8.5" r="1.5"/>
                                                <polyline points="21 15 16 10 5 21"/>
                                            </svg>
                                        </div>
                                    </div>
                                    <input type="file" id="review-cover-input" accept="image/*" class="hidden"/>
                                    <button class="btn btn-secondary btn-small" id="btn-upload-cover">
                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/>
                                            <polyline points="17 8 12 3 7 8"/>
                                            <line x1="12" y1="3" x2="12" y2="15"/>
                                        </svg>
                                        Upload Cover
                                    </button>
                                </div>
                            </div>

                            <div class="config-card">
                                <h3>Generate Episode</h3>
                                
                                <div class="config-section">
                                    <label>Voice</label>
                                    <div class="select-wrapper">
                                        <select id="review-voice" class="styled-select"></select>
                                    </div>
                                </div>

                                <div class="config-row">
                                    <div class="config-section half">
                                        <label>Format</label>
                                        <div class="select-wrapper">
                                            <select id="review-format" class="styled-select">
                                                <option value="wav">WAV</option>
                                                <option value="mp3">MP3</option>
                                                <option value="flac">FLAC</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="config-section half">
                                        <label>Strategy</label>
                                        <div class="select-wrapper">
                                            <select id="review-strategy" class="styled-select">
                                                <option value="paragraph">Paragraph</option>
                                                <option value="sentence">Sentence</option>
                                                <option value="heading">Section</option>
                                                <option value="max_chars">Character Limit</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>

                                <div class="config-row">
                                    <div class="config-section half">
                                        <label>Max Characters <span class="hint">per chunk</span></label>
                                        <input type="number" id="review-max-chars" value="2000" min="200" max="10000" step="100" class="text-input"/>
                                    </div>
                                    <div class="config-section half">
                                        <label>Breathing <span class="hint">natural pauses</span></label>
                                        <div class="select-wrapper">
                                            <select id="review-breathing" class="styled-select">
                                                <option value="none">None</option>
                                                <option value="light">Light</option>
                                                <option value="normal" selected>Normal</option>
                                                <option value="heavy">Heavy</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>

                                <div class="config-actions">
                                    <button class="btn btn-secondary" id="btn-review-preview-chunks">
                                        Preview Chunks
                                    </button>
                                    <button class="btn btn-primary btn-large" id="btn-review-generate">
                                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <polygon points="5 3 19 12 5 21 5 3"/>
                                        </svg>
                                        Generate
                                    </button>
                                </div>
                            </div>

                            <div class="chunks-preview-card hidden" id="review-chunk-preview">
                                <div class="card-header-compact">
                                    <h4>Chunks <span class="count" id="review-chunk-count">0</span></h4>
                                </div>
                                <div class="chunks-list" id="review-chunk-list"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- View: Source -->
                <div id="view-source" class="stage-view">
                    <div class="view-header-compact">
                        <div class="breadcrumbs">
                            <span class="crumb">Library</span>
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="9 18 15 12 9 6"/>
                            </svg>
                            <span class="crumb active" id="source-breadcrumb">Source</span>
                        </div>
                        <div class="header-actions">
                            <button class="btn btn-primary" id="btn-source-generate">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polygon points="5 3 19 12 5 21 5 3"/>
                                </svg>
                                Generate Episode
                            </button>
                            <button class="btn btn-ghost btn-danger" id="btn-delete-source">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="3 6 5 6 21 6"/>
                                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                                </svg>
                            </button>
                        </div>
                    </div>

                    <div class="source-detail">
                        <div class="detail-card">
                            <div class="card-header">
                                <h2 id="source-title">Source Title</h2>
                                <div class="header-actions">
                                    <button class="btn btn-secondary btn-small" id="btn-edit-source-text">
                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/>
                                            <path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"/>
                                        </svg>
                                        Edit Text
                                    </button>
                                </div>
                            </div>
                            <div class="meta-pills" id="source-meta">
                                <span class="pill">Text</span>
                                <span class="pill">0 chars</span>
                            </div>
                            <div class="text-content" id="source-cleaned-text"></div>
                            <textarea id="source-cleaned-textarea" class="text-editor hidden" rows="10"></textarea>
                            <div id="source-edit-actions" class="edit-actions hidden">
                                <button class="btn btn-primary btn-small" id="btn-save-source-text">Save</button>
                                <button class="btn btn-ghost btn-small" id="btn-cancel-source-edit">Cancel</button>
                            </div>
                        </div>

                        <div class="tags-card" data-testid="source-tags">
                            <h4>Tags</h4>
                            <div class="source-tags-list" id="source-tags-list"></div>
                            <div class="tag-creator">
                                <div class="select-wrapper" style="flex:1">
                                    <select id="source-tag-select" class="styled-select">
                                        <option value="">Add tag...</option>
                                    </select>
                                </div>
                                <button class="btn btn-secondary" id="btn-add-source-tag">Add</button>
                            </div>
                        </div>

                        <div class="reclean-card">
                            <h4>Re-clean Text</h4>
                            <div class="reclean-controls">
                                <div class="select-wrapper">
                                    <select id="source-reclean-rule" class="styled-select">
                                        <option value="skip">Skip code blocks</option>
                                        <option value="placeholder">Replace with placeholder</option>
                                        <option value="read">Read code aloud</option>
                                    </select>
                                </div>
                                <button class="btn btn-secondary" id="btn-reclean">Apply</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- View: Episode -->
                <div id="view-episode" class="stage-view">
                    <div class="view-header-compact">
                        <div class="breadcrumbs">
                            <span class="crumb">Library</span>
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="9 18 15 12 9 6"/>
                            </svg>
                            <span class="crumb active" id="episode-breadcrumb">Episode</span>
                        </div>
                        <div class="header-actions">
                            <button class="btn btn-secondary" id="btn-cancel-episode" style="display: none;">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="10"/>
                                    <line x1="15" y1="9" x2="9" y2="15"/>
                                    <line x1="9" y1="9" x2="15" y2="15"/>
                                </svg>
                                Cancel
                            </button>
                            <button class="btn btn-secondary" id="btn-retry-errors" style="display: none;">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="23 4 23 10 17 10"/>
                                    <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/>
                                </svg>
                                Retry Failed
                            </button>
                            <button class="btn btn-secondary" id="btn-regenerate-settings">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="3"/>
                                    <path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-2 2 2 2 0 01-2-2v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83 0 2 2 0 010-2.83l.06-.06a1.65 1.65 0 00.33-1.82 1.65 1.65 0 00-1.51-1H3a2 2 0 01-2-2 2 2 0 012-2h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 010-2.83 2 2 0 012.83 0l.06.06a1.65 1.65 0 001.82.33H9a1.65 1.65 0 001-1.51V3a2 2 0 012-2 2 2 0 012 2v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 0 2 2 0 010 2.83l-.06.06a1.65 1.65 0 00-.33 1.82V9a1.65 1.65 0 001.51 1H21a2 2 0 012 2 2 2 0 01-2 2h-.09a1.65 1.65 0 00-1.51 1z"/>
                                </svg>
                                Settings
                            </button>
                            <button class="btn btn-secondary" id="btn-regenerate-episode">Regenerate</button>
                            <button class="btn btn-secondary" id="btn-download-episode">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                    <polyline points="7 10 12 15 17 10"/>
                                    <line x1="12" y1="15" x2="12" y2="3"/>
                                </svg>
                                Download
                            </button>
                            <button class="btn btn-ghost btn-danger" id="btn-delete-episode">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="3 6 5 6 21 6"/>
                                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                                </svg>
                            </button>
                        </div>
                    </div>

                    <div class="episode-layout">
                        <div class="episode-info-card">
                            <div class="episode-header">
                                <h2 id="episode-title">Episode Title</h2>
                                <span class="status-badge" id="episode-status-badge">ready</span>
                            </div>
                            <div class="episode-meta-bar" id="episode-meta"></div>
                            
                            <div class="progress-section">
                                <div class="progress-info">
                                    <span class="progress-label">Generation Progress</span>
                                    <span class="progress-value" id="episode-progress-text">0%</span>
                                </div>
                                <div class="progress-bar-container">
                                    <div class="progress-bar" id="episode-progress-fill"></div>
                                </div>
                            </div>
                            
                            <div class="generation-status-detail" id="generation-status-detail">
                                <span class="gen-stage" id="gen-stage">Waiting in queue...</span>
                                <span class="gen-chunk-info" id="gen-chunk-info"></span>
                            </div>
                        </div>

                        <div class="tags-card" data-testid="episode-tags">
                            <h4>Tags</h4>
                            <div class="episode-tags-list" id="episode-tags-list"></div>
                            <div class="tag-creator">
                                <div class="select-wrapper" style="flex:1">
                                    <select id="episode-tag-select" class="styled-select">
                                        <option value="">Add tag...</option>
                                    </select>
                                </div>
                                <button class="btn btn-secondary" id="btn-add-episode-tag">Add</button>
                            </div>
                        </div>

                        <div class="chunks-grid" id="episode-chunks"></div>
                    </div>
                </div>

                <!-- View: Now Playing -->
                <div id="view-now-playing" class="stage-view">
                    <div class="view-hero compact">
                        <h1 class="hero-title">Now Playing</h1>
                    </div>
                    
                    <div class="now-playing-layout">
                        <div class="current-track-card">
                            <div class="track-artwork">
                                <div class="artwork-placeholder">
                                    <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                        <circle cx="12" cy="12" r="10"/>
                                        <polygon points="10 8 16 12 10 16 10 8" fill="currentColor" stroke="none"/>
                                    </svg>
                                </div>
                                <div class="playing-indicator" id="playing-indicator">
                                    <span></span>
                                    <span></span>
                                    <span></span>
                                </div>
                            </div>
                            <div class="track-details">
                                <h2 id="now-playing-title">No episode playing</h2>
                                <p id="now-playing-chunk">Select an episode to start listening</p>
                                <div class="track-progress">
                                    <div class="progress-bar-container large">
                                        <div class="progress-bar" id="now-playing-progress"></div>
                                    </div>
                                    <div class="progress-times">
                                        <span id="now-playing-current">0:00</span>
                                        <span id="now-playing-total">0:00</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="queue-card">
                            <div class="queue-header">
                                <h3>Up Next</h3>
                                <span class="queue-count" id="queue-count">0 chunks remaining</span>
                            </div>
                            <div class="queue-list" id="queue-list">
                                <div class="queue-empty">
                                    <p>Queue is empty</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- View: Library (full page for mobile) -->
                <div id="view-library" class="stage-view">
                    <div class="view-hero">
                        <h1 class="hero-title">Library</h1>
                        <p class="hero-subtitle">Your sources and episodes</p>
                    </div>
                    
                    <div class="library-content">
                        <div class="library-section">
                            <h3 class="section-title">Recent Episodes</h3>
                            <div class="library-episodes" id="library-episodes"></div>
                        </div>
                        
                        <div class="library-section">
                            <h3 class="section-title">Sources</h3>
                            <div class="library-sources" id="library-sources"></div>
                        </div>
                    </div>
                </div>

                <!-- View: Settings (full page for mobile) -->
                <div id="view-settings" class="stage-view">
                    <div class="view-hero">
                        <h1 class="hero-title">Settings</h1>
                        <p class="hero-subtitle">Configure your podcast studio</p>
                    </div>
                    
                    <div class="settings-fullpage">
                        <div class="settings-group">
                            <h4>Defaults</h4>
                            
                            <div class="setting-item">
                                <label>Voice</label>
                                <div class="select-wrapper">
                                    <select id="setting-voice-mobile" class="styled-select"></select>
                                </div>
                            </div>

                            <div class="setting-row">
                                <div class="setting-item half">
                                    <label>Format</label>
                                    <div class="select-wrapper">
                                        <select id="setting-format-mobile" class="styled-select">
                                            <option value="wav">WAV</option>
                                            <option value="mp3">MP3</option>
                                            <option value="flac">FLAC</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="setting-item half">
                                    <label>Strategy</label>
                                    <div class="select-wrapper">
                                        <select id="setting-strategy-mobile" class="styled-select">
                                            <option value="paragraph">Paragraph</option>
                                            <option value="sentence">Sentence</option>
                                            <option value="heading">Section</option>
                                            <option value="max_chars">Characters</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <div class="setting-item">
                                <label>Max Characters</label>
                                <input type="number" id="setting-max-chars-mobile" value="2000" min="200" max="10000" step="100" class="text-input"/>
                            </div>

                            <div class="setting-item">
                                <label>Code Blocks</label>
                                <div class="select-wrapper">
                                    <select id="setting-code-rule-mobile" class="styled-select">
                                        <option value="skip">Skip</option>
                                        <option value="placeholder">Placeholder</option>
                                        <option value="read">Read aloud</option>
                                    </select>
                                </div>
                            </div>

                            <div class="setting-item">
                                <label>Breathing <span class="hint">natural pauses</span></label>
                                <div class="select-wrapper">
                                    <select id="setting-breathing-mobile" class="styled-select">
                                        <option value="none">None</option>
                                        <option value="light">Light</option>
                                        <option value="normal" selected>Normal</option>
                                        <option value="heavy">Heavy</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <button class="btn btn-primary btn-full" id="btn-save-settings-mobile">Save Settings</button>

                        <div class="settings-group">
                            <h4>URL Import</h4>
                            
                            <div class="setting-item">
                                <label>Extraction Method</label>
                                <div class="select-wrapper">
                                    <select id="setting-url-extraction-mobile" class="styled-select">
                                        <option value="jina">jina.ai (Recommended)</option>
                                        <option value="manual">Manual / Trafilatura</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="settings-group">
                            <h4>Text Cleaning</h4>
                            
                            <div class="setting-item">
                                <label>Remove Non-Text</label>
                                <label class="toggle">
                                    <input type="checkbox" id="setting-clean-remove-non-text-mobile"/>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            
                            <div class="setting-item">
                                <label>Speak URLs</label>
                                <label class="toggle">
                                    <input type="checkbox" id="setting-clean-speak-urls-mobile"/>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            
                            <div class="setting-item">
                                <label>Handle Tables</label>
                                <label class="toggle">
                                    <input type="checkbox" id="setting-clean-handle-tables-mobile"/>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            
                            <div class="setting-item">
                                <label>Expand Abbreviations</label>
                                <label class="toggle">
                                    <input type="checkbox" id="setting-clean-expand-abbreviations-mobile"/>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            
                            <div class="setting-item">
                                <label>Preserve Parentheses <span class="hint">e.g. (text)</span></label>
                                <label class="toggle">
                                    <input type="checkbox" id="setting-clean-preserve-parentheses-mobile"/>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>

                        <div class="settings-group">
                            <h4>Subtitles</h4>
                            
                            <div class="setting-item">
                                <label>Show Subtitles</label>
                                <label class="toggle">
                                    <input type="checkbox" id="setting-show-subtitles-mobile"/>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            
                            <div class="setting-item">
                                <label>Subtitle Mode</label>
                                <div class="select-wrapper">
                                    <select id="setting-subtitle-mode-mobile" class="styled-select">
                                        <option value="full">Full Text</option>
                                        <option value="highlight">Word Highlight</option>
                                        <option value="minimal">Minimal</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="setting-item">
                                <label>Font Size</label>
                                <input type="range" id="setting-subtitle-font-size-mobile" min="12" max="32" step="2" value="16"/>
                                <span class="range-value" id="subtitle-font-value-mobile">16px</span>
                            </div>
                        </div>

                        <div class="settings-group">
                            <h4>Tags</h4>
                            <div class="tag-creator">
                                <input type="text" id="new-tag-name-mobile" placeholder="New tag..." class="text-input"/>
                                <button class="btn btn-secondary" id="btn-create-tag-mobile">Add</button>
                            </div>
                            <div class="tags-cloud" id="tags-list-mobile"></div>
                        </div>
                    </div>
                </div>
            </main>

            <!-- Right panel: Settings -->
            <aside class="drawer" id="drawer">
                <div class="drawer-header">
                    <h3>Settings</h3>
                </div>

                <div class="drawer-content">
                    <div class="settings-group">
                        <h4>Defaults</h4>
                        
                        <div class="setting-item">
                            <label>Voice</label>
                            <div class="select-wrapper">
                                <select id="setting-voice" class="styled-select"></select>
                            </div>
                        </div>

                        <div class="setting-row">
                            <div class="setting-item half">
                                <label>Format</label>
                                <div class="select-wrapper">
                                    <select id="setting-format" class="styled-select">
                                        <option value="wav">WAV</option>
                                        <option value="mp3">MP3</option>
                                        <option value="flac">FLAC</option>
                                    </select>
                                </div>
                            </div>
                            <div class="setting-item half">
                                <label>Strategy</label>
                                <div class="select-wrapper">
                                    <select id="setting-strategy" class="styled-select">
                                        <option value="paragraph">Paragraph</option>
                                        <option value="sentence">Sentence</option>
                                        <option value="heading">Section</option>
                                        <option value="max_chars">Characters</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="setting-item">
                            <label>Max Characters</label>
                            <input type="number" id="setting-max-chars" value="2000" min="200" max="10000" step="100" class="text-input"/>
                        </div>

                        <div class="setting-item">
                            <label>Code Blocks</label>
                            <div class="select-wrapper">
                                <select id="setting-code-rule" class="styled-select">
                                    <option value="skip">Skip</option>
                                    <option value="placeholder">Placeholder</option>
                                    <option value="read">Read aloud</option>
                                </select>
                            </div>
                        </div>

                        <div class="setting-item">
                            <label>Breathing <span class="hint">natural pauses</span></label>
                            <div class="select-wrapper">
                                <select id="setting-breathing" class="styled-select">
                                    <option value="none">None</option>
                                    <option value="light">Light</option>
                                    <option value="normal" selected>Normal</option>
                                    <option value="heavy">Heavy</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <button class="btn btn-primary btn-full" id="btn-save-settings">Save Settings</button>

                    <div class="settings-group">
                        <h4>URL Import</h4>
                        
                        <div class="setting-item">
                            <label>Extraction Method</label>
                            <div class="select-wrapper">
                                <select id="setting-url-extraction" class="styled-select">
                                    <option value="jina">jina.ai (Recommended)</option>
                                    <option value="manual">Manual / Trafilatura</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="settings-group">
                        <h4>Text Cleaning</h4>
                        
                        <div class="setting-item">
                            <label>Remove Non-Text</label>
                            <label class="toggle">
                                <input type="checkbox" id="setting-clean-remove-non-text"/>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="setting-item">
                            <label>Speak URLs</label>
                            <label class="toggle">
                                <input type="checkbox" id="setting-clean-speak-urls"/>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="setting-item">
                            <label>Handle Tables</label>
                            <label class="toggle">
                                <input type="checkbox" id="setting-clean-handle-tables"/>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="setting-item">
                            <label>Expand Abbreviations</label>
                            <label class="toggle">
                                <input type="checkbox" id="setting-clean-expand-abbreviations"/>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="setting-item">
                            <label>Preserve Parentheses <span class="hint">e.g. (text)</span></label>
                            <label class="toggle">
                                <input type="checkbox" id="setting-clean-preserve-parentheses"/>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="settings-group">
                        <h4>Subtitles</h4>
                        
                        <div class="setting-item">
                            <label>Show Subtitles</label>
                            <label class="toggle">
                                <input type="checkbox" id="setting-show-subtitles"/>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="setting-item">
                            <label>Subtitle Mode</label>
                            <div class="select-wrapper">
                                <select id="setting-subtitle-mode" class="styled-select">
                                    <option value="full">Full Text</option>
                                    <option value="highlight">Word Highlight</option>
                                    <option value="minimal">Minimal</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <label>Font Size</label>
                            <input type="range" id="setting-subtitle-font-size" min="12" max="32" step="2" value="16"/>
                            <span class="range-value" id="subtitle-font-value">16px</span>
                        </div>
                    </div>

                    <div class="settings-group">
                        <h4>Tags</h4>
                        <div class="tag-creator">
                            <input type="text" id="new-tag-name" placeholder="New tag..." class="text-input"/>
                            <button class="btn btn-secondary" id="btn-create-tag">Add</button>
                        </div>
                        <div class="tags-cloud" id="tags-list"></div>
                    </div>
                </div>
            </aside>
        </div>

        <!-- Mini Player Bar -->
        <div class="player-bar hidden" id="player-bar">
            <!-- Progress line across top -->
            <div class="mini-progress-track">
                <div class="mini-progress-fill" id="scrubber-fill"></div>
            </div>
            <div class="mini-player-inner" id="mini-player-tap-target">
                <div class="mini-player-info">
                    <span class="mini-player-title" id="player-title">--</span>
                    <span class="mini-player-sub" id="player-chunk-label">Select an episode to play</span>
                </div>
                <div class="mini-player-controls">
                    <button class="mini-ctrl-btn" id="player-play" aria-label="Play or pause">
                        <svg width="22" height="22" viewBox="0 0 24 24" fill="currentColor" id="play-icon">
                            <polygon points="6 3 20 12 6 21 6 3"/>
                        </svg>
                        <svg width="22" height="22" viewBox="0 0 24 24" fill="currentColor" id="pause-icon" style="display:none">
                            <rect x="5" y="3" width="5" height="18" rx="1"/>
                            <rect x="14" y="3" width="5" height="18" rx="1"/>
                        </svg>
                    </button>
                    <button class="mini-ctrl-btn" id="player-next" aria-label="Next chunk">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <polygon points="5 4 15 12 5 20 5 4"/>
                            <line x1="19" y1="5" x2="19" y2="19" stroke="currentColor" stroke-width="2.5"/>
                        </svg>
                    </button>
                </div>
            </div>
            <!-- Hidden elements for compatibility -->
            <span id="player-chunk-num" style="display:none"></span>
            <span id="player-time-current" style="display:none">0:00</span>
            <span id="player-time-total" style="display:none">0:00</span>
            <input type="range" id="player-scrubber" min="0" max="100" value="0" step="0.1" style="display:none"/>
            <button id="player-prev" style="display:none"></button>
            <button id="player-skip-back" style="display:none"></button>
            <button id="player-skip-fwd" style="display:none"></button>
            <button id="btn-sleep-timer" style="display:none"><span id="sleep-timer-indicator" class="sleep-timer-indicator"></span></button>
            <button id="btn-mute" style="display:none"></button>
            <button id="btn-share" style="display:none"></button>
            <button id="btn-expand-player" style="display:none"></button>
            <button id="btn-queue-toggle" style="display:none"></button>
            <button id="player-download" style="display:none"></button>
            <select id="playback-speed" style="display:none">
                <option value="0.5">0.5x</option>
                <option value="0.75">0.75x</option>
                <option value="1" selected>1x</option>
                <option value="1.25">1.25x</option>
                <option value="1.5">1.5x</option>
                <option value="1.75">1.75x</option>
                <option value="2">2x</option>
                <option value="2.5">2.5x</option>
                <option value="3">3x</option>
            </select>
            <canvas id="waveform-canvas" style="display:none"></canvas>
        </div>
    </div>

    <!-- Mobile Bottom Navigation -->
    <nav class="mobile-nav" id="mobile-nav">
        <a href="#import" class="mobile-nav-item active" data-route="import">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <path d="M12 5v14M5 12h14"/>
            </svg>
            <span>Generate</span>
        </a>
        <a href="#library" class="mobile-nav-item" data-route="library">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z"/>
            </svg>
            <span>Library</span>
        </a>
        <a href="#search" class="mobile-nav-item" data-route="search">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <circle cx="11" cy="11" r="8"/>
                <line x1="21" y1="21" x2="16.65" y2="16.65"/>
            </svg>
            <span>Search</span>
        </a>
        <a href="#settings" class="mobile-nav-item" data-route="settings">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <circle cx="12" cy="12" r="3"/>
                <path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-2 2 2 2 0 01-2-2v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83 0 2 2 0 010-2.83l.06-.06a1.65 1.65 0 00.33-1.82 1.65 1.65 0 00-1.51-1H3a2 2 0 01-2-2 2 2 0 012-2h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 010-2.83 2 2 0 012.83 0l.06.06a1.65 1.65 0 001.82.33H9a1.65 1.65 0 001-1.51V3a2 2 0 012-2 2 2 0 012 2v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 0 2 2 0 010 2.83l-.06.06a1.65 1.65 0 00-.33 1.82V9a1.65 1.65 0 001.51 1H21a2 2 0 012 2 2 2 0 01-2 2h-.09a1.65 1.65 0 00-1.51 1z"/>
            </svg>
            <span>Settings</span>
        </a>
    </nav>

    <!-- Fullscreen Player Overlay -->
    <div class="fullscreen-player hidden" id="fullscreen-player">
        <div class="fs-player-header">
            <button class="fs-btn-minimize" id="fs-btn-minimize" aria-label="Minimize player">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                    <polyline points="6 9 12 15 18 9"/>
                </svg>
            </button>
            <div class="fs-header-center">
                <span class="fs-track-title-small" id="fs-track-title">Episode Title</span>
                <span class="fs-episode-info-small" id="fs-episode-info">Tap play to begin</span>
            </div>
            <button class="fs-btn-more" id="fs-btn-more" aria-label="More options">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="5" r="1.5" fill="currentColor"/>
                    <circle cx="12" cy="12" r="1.5" fill="currentColor"/>
                    <circle cx="12" cy="19" r="1.5" fill="currentColor"/>
                </svg>
            </button>
        </div>

        <div class="fs-body">
            <!-- Karaoke Subtitle Panel - THE ENTIRE CENTER OF THE SCREEN -->
            <div class="fs-karaoke-panel" id="fs-subtitles-container">
                <div class="fs-karaoke-sentence" id="fs-subtitle-text">
                    <span class="karaoke-word">Tap</span>
                    <span class="karaoke-word">play</span>
                    <span class="karaoke-word">to</span>
                    <span class="karaoke-word">start</span>
                    <span class="karaoke-word">listening</span>
                </div>
                <div class="fs-chunk-indicator" id="fs-chunk-indicator">
                    <span class="chunk-label" id="fs-chunk-label">Part 1 of 1</span>
                </div>
            </div>

            <!-- Hidden cover art for MediaSession -->
            <img id="fs-cover-image" src="" alt="" class="hidden" style="display:none"/>

            <!-- Controls Section (pinned to bottom) -->
            <div class="fs-controls-dock">
                <!-- Chunked Progress Bar -->
                <div class="fs-progress-container">
                    <div class="fs-progress-track" id="fs-progress-track">
                        <div class="fs-chunk-segments" id="fs-chunk-segments"></div>
                        <div class="fs-progress-fill" id="fs-progress-fill"></div>
                        <input type="range" class="fs-scrubber" id="fs-scrubber" min="0" max="100" value="0" step="0.1"/>
                    </div>
                    <div class="fs-time-display">
                        <span id="fs-time-current">0:00</span>
                        <span id="fs-time-remaining">-0:00</span>
                    </div>
                </div>

                <!-- Main Controls -->
                <div class="fs-main-controls">
                    <button class="fs-speed-pill" id="fs-speed-pill" aria-label="Playback speed">
                        <span id="fs-speed-label">1x</span>
                    </button>

                    <button class="fs-nav-btn" id="fs-btn-prev" aria-label="Previous chunk">
                        <svg width="22" height="22" viewBox="0 0 24 24" fill="currentColor">
                            <polygon points="19 20 9 12 19 4 19 20"/>
                            <line x1="5" y1="19" x2="5" y2="5" stroke="currentColor" stroke-width="2.5"/>
                        </svg>
                    </button>

                    <button class="fs-skip-btn" id="fs-btn-skip-back" aria-label="Skip back 10 seconds">
                        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M1 4v6h6"/>
                            <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"/>
                        </svg>
                        <span class="fs-skip-label">10</span>
                    </button>

                    <button class="fs-play-btn" id="fs-btn-play" aria-label="Play or pause">
                        <svg width="36" height="36" viewBox="0 0 24 24" fill="currentColor" id="fs-play-icon">
                            <polygon points="6 3 20 12 6 21 6 3"/>
                        </svg>
                        <svg width="36" height="36" viewBox="0 0 24 24" fill="currentColor" id="fs-pause-icon" style="display:none">
                            <rect x="5" y="3" width="5" height="18" rx="1"/>
                            <rect x="14" y="3" width="5" height="18" rx="1"/>
                        </svg>
                    </button>

                    <button class="fs-skip-btn" id="fs-btn-skip-forward" aria-label="Skip forward 10 seconds">
                        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M23 4v6h-6"/>
                            <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/>
                        </svg>
                        <span class="fs-skip-label">10</span>
                    </button>

                    <button class="fs-nav-btn" id="fs-btn-next" aria-label="Next chunk">
                        <svg width="22" height="22" viewBox="0 0 24 24" fill="currentColor">
                            <polygon points="5 4 15 12 5 20 5 4"/>
                            <line x1="19" y1="5" x2="19" y2="19" stroke="currentColor" stroke-width="2.5"/>
                        </svg>
                    </button>

                    <button class="fs-speed-pill fs-queue-pill" id="fs-btn-playlist" aria-label="Queue" title="Queue">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="8" y1="6" x2="21" y2="6"/>
                            <line x1="8" y1="12" x2="21" y2="12"/>
                            <line x1="8" y1="18" x2="21" y2="18"/>
                            <line x1="3" y1="6" x2="3.01" y2="6"/>
                            <line x1="3" y1="12" x2="3.01" y2="12"/>
                            <line x1="3" y1="18" x2="3.01" y2="18"/>
                        </svg>
                    </button>
                </div>

                <!-- Bottom Controls Row -->
                <div class="fs-bottom-row">
                    <button class="fs-control-btn" id="fs-btn-sleep" title="Sleep timer">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <polyline points="12 6 12 12 16 14"/>
                        </svg>
                        <span class="sleep-indicator" id="fs-sleep-indicator"></span>
                    </button>

                    <div class="fs-volume-control">
                        <button class="fs-control-btn" id="fs-btn-mute" title="Mute">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="volume-icon">
                                <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/>
                                <path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"/>
                            </svg>
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="mute-icon" style="display:none">
                                <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/>
                                <line x1="23" y1="9" x2="17" y2="15"/>
                                <line x1="17" y1="9" x2="23" y2="15"/>
                            </svg>
                        </button>
                        <input type="range" class="fs-volume-slider" id="fs-volume-slider" min="0" max="1" step="0.05" value="1"/>
                    </div>

                    <button class="fs-control-btn" id="fs-btn-download" title="Download">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                            <polyline points="7 10 12 15 17 10"/>
                            <line x1="12" y1="15" x2="12" y2="3"/>
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        <!-- Hidden elements for cover art loading -->
        <div id="fs-cover-art" style="display:none">
            <div id="fs-cover-placeholder"></div>
        </div>
        <div id="fs-playing-indicator" style="display:none"></div>
    </div>

    <!-- Bottom Sheet Context Menu -->
    <div class="bottom-sheet-overlay hidden" id="bottom-sheet-overlay">
        <div class="bottom-sheet" id="bottom-sheet">
            <div class="bottom-sheet-header">
                <div class="bottom-sheet-handle"></div>
                <h3 id="bottom-sheet-title">Actions</h3>
            </div>
            <div class="bottom-sheet-content" id="bottom-sheet-content">
                <!-- Dynamic content -->
            </div>
        </div>
    </div>

    <!-- Bulk Actions Bar -->
    <div class="bulk-actions-bar hidden" id="bulk-actions-bar">
        <span class="bulk-count" id="bulk-count">0 selected</span>
        <div class="bulk-buttons">
            <button class="bulk-btn" id="bulk-move-btn">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z"/>
                </svg>
                Move
            </button>
            <button class="bulk-btn danger" id="bulk-delete-btn">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="3 6 5 6 21 6"/>
                    <path d="M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/>
                </svg>
                Delete
            </button>
        </div>
        <button class="bulk-btn-close" id="bulk-close-btn">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="18" y1="6" x2="6" y2="18"/>
                <line x1="6" y1="6" x2="18" y2="18"/>
            </svg>
        </button>
    </div>

    <!-- Keyboard shortcuts modal -->
    <div class="modal-overlay hidden" id="keyboard-modal" role="dialog" aria-modal="true" aria-labelledby="keyboard-modal-title">
        <div class="modal">
            <div class="modal-header">
                <h3 id="keyboard-modal-title">Keyboard Shortcuts</h3>
                <button class="btn btn-ghost modal-close" id="close-keyboard-modal" aria-label="Close">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="shortcuts-grid">
                    <div class="shortcut-item">
                        <kbd>Space</kbd>
                        <span>Play / Pause</span>
                    </div>
                    <div class="shortcut-item">
                        <kbd></kbd>
                        <span>Skip back 10s</span>
                    </div>
                    <div class="shortcut-item">
                        <kbd></kbd>
                        <span>Skip forward 10s</span>
                    </div>
                    <div class="shortcut-item">
                        <kbd>N</kbd>
                        <span>Next chunk</span>
                    </div>
                    <div class="shortcut-item">
                        <kbd>P</kbd>
                        <span>Previous chunk</span>
                    </div>
                    <div class="shortcut-item">
                        <kbd>Q</kbd>
                        <span>Show queue</span>
                    </div>
                    <div class="shortcut-item">
                        <kbd>?</kbd>
                        <span>Show this help</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Regenerate Settings Modal -->
    <div class="modal-overlay hidden" id="regen-settings-modal" role="dialog" aria-modal="true" aria-labelledby="regen-settings-title">
        <div class="modal">
            <div class="modal-header">
                <h3 id="regen-settings-title">Regenerate with Settings</h3>
                <button class="btn btn-ghost modal-close" id="regen-settings-close" aria-label="Close">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <p class="modal-desc">Change voice or format and regenerate. You'll have 2 minutes to undo.</p>
                
                <div class="input-group">
                    <label for="regen-voice">Voice</label>
                    <select id="regen-voice" class="text-input">
                        <option value="">Same as before</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label for="regen-format">Audio Format</label>
                    <select id="regen-format" class="text-input">
                        <option value="">Same as before</option>
                        <option value="wav">WAV (high quality)</option>
                        <option value="mp3">MP3 (smaller size)</option>
                        <option value="ogg">OGG (web optimized)</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label for="regen-strategy">Chunk Strategy</label>
                    <select id="regen-strategy" class="text-input">
                        <option value="">Same as before</option>
                        <option value="sentence">By Sentence</option>
                        <option value="paragraph">By Paragraph</option>
                        <option value="fixed">Fixed Length</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-ghost" id="regen-settings-cancel">Cancel</button>
                <button class="btn btn-primary" id="regen-settings-confirm">Regenerate</button>
            </div>
        </div>
    </div>

    <!-- Confirm dialog -->
    <div class="modal-overlay hidden" id="confirm-modal" role="alertdialog" aria-modal="true" aria-labelledby="confirm-title" aria-describedby="confirm-message">
        <div class="modal modal-sm">
            <div class="modal-header">
                <h3 id="confirm-title">Confirm</h3>
            </div>
            <div class="modal-body">
                <p id="confirm-message" class="confirm-text"></p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-ghost" id="confirm-cancel">Cancel</button>
                <button class="btn btn-danger" id="confirm-ok">Delete</button>
            </div>
        </div>
    </div>

    <script type="module" src="/static/js/studio/main.js"></script>
</body>
</html>
